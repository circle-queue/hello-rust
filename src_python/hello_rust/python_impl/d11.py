import itertools
from typing import NamedTuple


class Vector2D(NamedTuple):
    x: int
    y: int

    def __sub__(self, other: "Vector2D"):
        return Vector2D(self.x - other.x, self.y - other.y)

    def __len__(self):
        return abs(self.x) + abs(self.y)


def solve1(input: list[str]) -> str:
    stars = [
        (i, j)
        for i, line in enumerate(input)
        for j, char in enumerate(line)
        if char == "#"
    ]
    i_star, j_star = map(set, zip(*stars))
    i_missing = set(range(len(input))) - i_star
    j_missing = set(range(len(input[0]))) - j_star

    new_input = input.copy()
    new_input = [
        "".join((".." if j in j_missing else char) for j, char in enumerate(line))
        for line in new_input
    ]
    new_input = [
        line
        for i, first_line in enumerate(new_input)
        for line in [first_line] * (2 if i in i_missing else 1)
    ]

    stars_now = [
        Vector2D(i, j)
        for i, line in enumerate(new_input)
        for j, char in enumerate(line)
        if char == "#"
    ]

    total_dist = 0
    for a, b in itertools.combinations(stars_now, 2):
        total_dist += len(a - b)

    return str(total_dist)


def solve2(input: list[str]) -> str:
    stars = [
        (i, j)
        for i, line in enumerate(input)
        for j, char in enumerate(line)
        if char == "#"
    ]
    i_star, j_star = map(set, zip(*stars))
    i_missing = set(range(len(input))) - i_star
    j_missing = set(range(len(input[0]))) - j_star

    stars_now = []
    expansion_factor = 1_000_000 - 1

    i_expansion = 0
    for i, line in enumerate(input):
        j_expansion = 0
        if i in i_missing:
            i_expansion += expansion_factor
        for j, char in enumerate(line):
            if j in j_missing:
                j_expansion += expansion_factor

            if char == "#":
                stars_now.append(Vector2D(i + i_expansion, j + j_expansion))

    total_dist = 0
    for a, b in itertools.combinations(stars_now, 2):
        total_dist += len(a - b)
        total_dist
    return str(total_dist)


sample_input2 = sample_input1 = """...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....""".splitlines()

full_input1 = full_input2 = """....................................#..............#.................................#......................................................
............#......#..........................................................#.....................................#.................#.....
.........................................................................................#...................#..............................
.....#......................................................#...............................................................................
..........................................................................#........................#.............................#..........
......................#.................#...............................................................................#...................
........#......................................................#...............................#............................................
...........................#.................#.......................................#...................#.........#.................#......
.#................#.......................................#..........#........#.............................................................
............................................................................................................................................
..................................#.........................................................................................................
.........................................................................................#.................................#................
.......#.............#................................#........#.....................................#......................................
..........................................#.................................................................................................
.............#...............................................................................................#..........#...................
....................................#.................................#............#....................#......................#............
............................................................................................#...............................................
........#...........................................#.......#.............................................................................#.
.....................#.......#..................................................#....................................................#......
..............#........................#.......#........................#................................................#..................
.......................................................#..........................................................#.........................
..#..............................................................#..........#.......................#.......................................
..................................................#......................................................#..................................
......................................................................................................................#.....................
.....#................................#...............................................#.....................................................
...................#.....#...............................#.......................#..............#..........................#................
.........#.................................#................................................................................................
..................................................................#.................................#......#.......................#........
............................#........................................................................................#..................#...
.................#...............................#............#............#................................................................
................................#................................................................#..........................................
............................................#.........................................#.......................................#.............
.........#.................................................................................#............................#............#......
..#....................................................#..........#.............#.........................#.................................
...........................#...................#............................................................................................
...................................#...................................#..........................................................#.........
................#..................................................................#..................#..........#..........................
.............................................................#...............................#..............................................
#.................................................................................................#.......................#.................
.........................#...............#..................................................................................................
...........................................................................................................#..................#......#......
.........................................................#.................................................................................#
..............................#.............#......#....................................................................#...................
.....#......................................................................#...............................................................
...............................................................................................................#.......................#....
............#.........#................#...............#............#...........#...........#........................#......................
............................................................................................................................................
................#.................................#............#..........................................................#........#........
...............................#...............................................................#...........................................#
.........................................#.............................#.............................#......................................
...................................................................................#.......................#................................
.........#................#...................#.........................................#...............................#...............#...
....................#................#......................................#.....................#.............#...........................
............................................................................................................................................
......................................................................#.....................................................................
......#..........................................................#........................................................................#.
.............#.........................#.......................................#............................#.....#......#..................
.........................#........#.........#......#.................................#.....#................................................
..#.....................................................#.........................................#.........................................
....................#...............................................#.......................................................................
........................................................................................................#.......................#.......#...
.............................#...................................................#.........................................#................
....................................................................................................#.......................................
.......#..........#..............................................#........#.................#..................#............................
....................................#..........#......#.....#.........................................................#.............#.......
............................................................................................................................................
..............................#................................................................#..........#.................................
..#..............................................................................................................................#..........
..............................................................................................................#.............................
.................................................#........................#...............................................#.................
...................#.....................................................................................................................#..
......#....................#......#.....#................#...................................#.............#................................
.............................................#.......................................#...............................#......................
.................................................................................................#..........................................
...#.................................................................#...........#..........................................................
....................#..............................................................................................................#........
..........#.....................#...........................................................#.............#...............................#.
............................................................................................................................................
..................................................#............................................................#...........#................
...........................................#........................#.........#.....................#.......................................
.#.........................#..............................#.................................................................................
.....................................................................................#.........................................#............
..............................................................................................#......................#...................#..
.....#...........#.....#.....................#..............................................................#...............................
..........#....................................................#.....#......................................................................
#...............................#.....#.....................................................................................................
........................................................#.........................#...................#........#..................#.........
.............................................................................................................................#.............#
.........................................................................#.................................#................................
.........#.......#................................#..............................................#.....................................#....
............................................................................................................................................
................................#............#........................#.........................................#...........................
............#...............................................#........................#................#...............#.....................
..#....................#..........................................#..........................................................#..............
...................................................#......................................................................................#.
................#....................................................................................................................#......
.......#..................................................#...................#.............#..............#................................
.................................................................................................................................#..........
...................#...........#............................................................................................................
.........................................#.....................#....................................#.........#.......#.....................
.#........................................................................#..............................#..................................
............#.....................#.....................................................................................................#...
.......#....................................................................................................................................
.................................................................#............#...................#........................#......#.........
........................................................................................#.......................#...........................
.........................................#.............................#....................................................................
..............#......#...............................................................................................................#......
................................................................................................#......................#....................
............................#............................#..........................#..................#...................................#
...........#...............................................................................#....................................#...........
............................................................................................................................................
.................#.......#............#.......................................................................#.............................
............................................................................................................................................
...#.........................#.................................#...............#............................................#.....#.........
......................................................#...................#..........#.........#.....#....................................#.
...................................#.........#......................................................................#.......................
............................................................................................................................................
..........#..............#...................................#..............................................................................
............................................................................................................................................
.....#...................................................#...............................#...................#..........#..................#
..............................#.......#........#............................................................................................
.................#...............................................................#.................................#........................
.....................................................................#........................................................#.............
............#..................................................................................#............................................
.......................#..................................#..............................................................#.............#....
...................................#........................................................................................................
...........................................................................#.......................................................#........
........#....................#.....................#...............#................................#..............#........................
...#.........#.............................#.........................................#...................#..................................
..............................................................................#..............#........................................#.....
..................................#.......................................................................................#.................
........................#...................................................................................................................
.......................................................#.............................................#............#.........................
............................#........#..............................#.......................................................................
...#........................................................#............#............#............................................#........
.................#..........................#...............................................................................................
..........................................................................................#................................................#
..........#.................................................................................................................................
.........................#............#........................................................#............................................
...............#...................................#......................#..............................#...........#......................""".splitlines()

if __name__ == "__main__":
    input = sample_input1
    # input = full_input1

    print(solve1(input))
    # print(solve2(input))
    # print(solve1(input))
    # print(solve2(input))
